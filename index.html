<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ExploreMeet Premium</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- PREMIUM GLASSMORPHISM THEME --- */
        :root {
            --primary: #ff0055; /* Neon Pink */
            --gold: #ffd700;   /* VIP Gold */
            --dark: #0f0f1a;   /* Deep Blue/Black */
            --glass: rgba(255, 255, 255, 0.1);
            --border: rgba(255, 255, 255, 0.2);
        }

        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Segoe UI', sans-serif; background: var(--dark); color: white; overflow: hidden; }

        /* Animated Background */
        .bg-blobs { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; }
        .blob { position: absolute; border-radius: 50%; filter: blur(60px); opacity: 0.4; animation: float 10s infinite alternate; }
        .b1 { width: 300px; height: 300px; background: var(--primary); top: -50px; left: -50px; }
        .b2 { width: 250px; height: 250px; background: #6c5ce7; bottom: -50px; right: -50px; animation-delay: 2s; }
        @keyframes float { from { transform: translate(0,0); } to { transform: translate(20px, 40px); } }

        /* --- 1. LOGIN SCREEN --- */
        #landing-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 2000;
            backdrop-filter: blur(10px);
        }
        .app-title { font-size: 3.5rem; font-weight: 800; background: linear-gradient(to right, #ff00cc, #333399); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .login-btn {
            background: white; color: black; border: none; padding: 15px 40px; border-radius: 50px; font-weight: bold; font-size: 1.1rem;
            box-shadow: 0 0 20px rgba(255, 0, 85, 0.5); margin-top: 40px; cursor: pointer; transition: 0.3s;
        }

        /* --- 2. MAIN APP --- */
        #app-interface { display: none; height: 100%; flex-direction: column; }

        .header {
            height: 70px; display: flex; align-items: center; justify-content: space-between; padding: 0 20px;
            background: rgba(0,0,0,0.5); backdrop-filter: blur(10px); border-bottom: 1px solid var(--border);
        }
        .vip-badge {
            background: linear-gradient(45deg, var(--gold), #ffaa00); color: black; padding: 5px 15px; border-radius: 20px;
            font-weight: bold; font-size: 0.8rem; display: none; box-shadow: 0 0 10px var(--gold);
        }

        .screen-container { flex: 1; overflow-y: auto; padding: 20px; }
        .screen { display: none; flex-direction: column; align-items: center; animation: popIn 0.4s ease; }
        .active-screen { display: flex; }
        @keyframes popIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }

        /* --- HOME (MATCH) --- */
        .radar-box {
            width: 250px; height: 250px; position: relative; display: flex; align-items: center; justify-content: center; margin-top: 40px;
        }
        .radar-circle {
            position: absolute; border: 1px solid var(--primary); border-radius: 50%; opacity: 0;
            width: 100%; height: 100%; animation: radarWave 2s infinite;
        }
        .radar-circle:nth-child(2) { animation-delay: 0.5s; }
        .radar-circle:nth-child(3) { animation-delay: 1s; }
        @keyframes radarWave { 0% { transform: scale(0.5); opacity: 1; } 100% { transform: scale(1.5); opacity: 0; } }

        .user-avatar { width: 100px; height: 100px; border-radius: 50%; border: 3px solid white; z-index: 2; object-fit: cover; }

        .match-btn {
            background: linear-gradient(45deg, #ff0055, #ff4444); color: white; border: none; padding: 18px 60px;
            border-radius: 50px; font-size: 1.4rem; font-weight: bold; margin-top: 50px;
            box-shadow: 0 10px 30px rgba(255, 0, 85, 0.4); cursor: pointer; transition: 0.2s;
        }
        .match-btn:active { transform: scale(0.95); }

        /* --- PROFILE & VIP --- */
        .profile-card {
            width: 100%; background: var(--glass); border: 1px solid var(--border); padding: 30px;
            border-radius: 20px; text-align: center; backdrop-filter: blur(10px);
        }
        .vip-buy-btn {
            background: linear-gradient(45deg, #ffd700, #ffaa00); color: black; border: none; width: 100%; padding: 15px;
            border-radius: 15px; font-weight: bold; font-size: 1.1rem; margin-top: 20px; cursor: pointer;
            animation: shine 2s infinite;
        }
        @keyframes shine { 0% { filter: brightness(1); } 50% { filter: brightness(1.2); } 100% { filter: brightness(1); } }

        /* --- ADS AREA --- */
        #ad-box {
            width: 100%; height: 60px; background: #222; display: flex; align-items: center; justify-content: center;
            color: #555; font-size: 0.8rem; border-top: 1px solid var(--border);
        }
        .hidden-ad { display: none !important; }

        /* --- BOTTOM NAV --- */
        .bottom-nav {
            height: 70px; background: rgba(0,0,0,0.8); display: flex; justify-content: space-around; align-items: center;
            backdrop-filter: blur(10px); border-top: 1px solid var(--border);
        }
        .nav-item { font-size: 1.6rem; color: #666; transition: 0.3s; cursor: pointer; }
        .nav-item.active { color: var(--primary); text-shadow: 0 0 15px var(--primary); transform: translateY(-5px); }

        /* --- VIDEO CALL LAYERS --- */
        #video-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 5000; display: none; }
        
        #searching-ui {
            position: absolute; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 5002;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }

        #next-overlay {
            position: absolute; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 5003;
            display: none; flex-direction: column; align-items: center; justify-content: center;
        }

        #in-call-controls {
            position: absolute; bottom: 100px; right: 20px; z-index: 5004; display: none; flex-direction: column; gap: 15px;
        }
        .ctrl-btn {
            width: 60px; height: 60px; border-radius: 50%; border: none; font-size: 1.5rem;
            display: flex; align-items: center; justify-content: center; cursor: pointer;
            background: rgba(255,255,255,0.2); backdrop-filter: blur(5px); color: white; border: 1px solid rgba(255,255,255,0.3);
        }
        .ctrl-btn.friend { color: #ff0055; background: white; }

        /* Friend List */
        .friend-row {
            display: flex; align-items: center; padding: 15px; background: var(--glass); margin-bottom: 10px; border-radius: 15px;
        }

    </style>
</head>
<body>

    <div class="bg-blobs">
        <div class="blob b1"></div>
        <div class="blob b2"></div>
    </div>

    <div id="landing-screen">
        <h1 class="app-title">ExploreMeet</h1>
        <p style="color: #ccc; letter-spacing: 2px;">PREMIUM DATING</p>
        <button id="login-btn" class="login-btn"><i class="fab fa-google"></i> Login with Google</button>
    </div>

    <div id="app-interface">
        <div class="header">
            <h2 style="margin:0; color:white;">Explore<span style="color:var(--primary);">Meet</span></h2>
            <div id="vip-status" class="vip-badge"><i class="fas fa-crown"></i> VIP MEMBER</div>
        </div>

        <div class="screen-container">
            
            <div id="screen-home" class="screen active-screen">
                <div class="radar-box">
                    <div class="radar-circle"></div>
                    <div class="radar-circle"></div>
                    <div class="radar-circle"></div>
                    <img id="my-avatar" class="user-avatar" src="">
                </div>
                <h2 style="margin-top: 30px;">Find Your Match</h2>
                <p style="color: #aaa;">1000+ Users Online</p>
                <button onclick="startSearch()" class="match-btn">Start Video Chat</button>
            </div>

            <div id="screen-messages" class="screen">
                <h3 style="align-self: flex-start;">My Connections</h3>
                <div id="friends-list" style="width: 100%; margin-top: 10px;"></div>
            </div>

            <div id="screen-profile" class="screen">
                <div class="profile-card">
                    <img id="profile-img-big" class="user-avatar" style="width: 120px; height: 120px; margin-bottom: 20px;">
                    <h2 id="profile-name">User Name</h2>
                    <p style="color: #888;">Free Plan</p>
                    
                    <button id="buy-vip-btn" class="vip-buy-btn" onclick="buyVIP()">
                        <i class="fas fa-crown"></i> Upgrade to VIP (Remove Ads)
                    </button>
                    
                    <button onclick="logout()" style="margin-top: 30px; background: transparent; border: 1px solid #ff4444; color: #ff4444; padding: 10px 30px; border-radius: 30px;">Logout</button>
                </div>
            </div>

        </div>

        <div id="ad-box">
            <span>[ Banner Ads Space ]</span>
        </div>

        <div class="bottom-nav">
            <div class="nav-item active" onclick="switchTab('home')"><i class="fas fa-fire"></i></div>
            <div class="nav-item" onclick="switchTab('messages')"><i class="fas fa-comment-dots"></i></div>
            <div class="nav-item" onclick="switchTab('profile')"><i class="fas fa-user"></i></div>
        </div>
    </div>

    <div id="video-layer">
        
        <div id="searching-ui">
            <div class="radar-box" style="transform: scale(0.6);">
                <div class="radar-circle"></div>
                <div class="radar-circle"></div>
                <i class="fas fa-search" style="font-size: 3rem; color: white;"></i>
            </div>
            <h3>Searching Partner...</h3>
        </div>

        <div id="video-embed" style="width: 100%; height: 100%;"></div>

        <div id="in-call-controls">
            <button class="ctrl-btn friend" onclick="addFriend()"><i class="fas fa-heart"></i></button>
            <button class="ctrl-btn" onclick="skipUser()"><i class="fas fa-forward"></i></button>
        </div>

        <div id="next-overlay">
            <h2 style="font-size: 2.5rem;">Call Ended</h2>
            <button onclick="retryMatch()" class="match-btn" style="margin-top: 20px;">Find Next <i class="fas fa-arrow-right"></i></button>
            <button onclick="exitVideo()" style="margin-top: 20px; background: transparent; color: #aaa; border: none;">Go Home</button>
        </div>
    </div>

    <script src="https://unpkg.com/@zegocloud/zego-uikit-prebuilt/zego-uikit-prebuilt.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, set, onValue, remove, push, get, onDisconnect, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDB6H5YFrr7gD7YmRsinknALrp5_RL3dLA",
            authDomain: "exploremeet---live.firebaseapp.com",
            databaseURL: "https://exploremeet---live-default-rtdb.firebaseio.com",
            projectId: "exploremeet---live",
            storageBucket: "exploremeet---live.firebasestorage.app",
            messagingSenderId: "169038218786",
            appId: "1:169038218786:web:4282137dbeb92000dbac7b"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);
        let currentUser = null;
        let zegoInstance = null;
        let currentPartnerUID = null;

        // AUTH & VIP CHECK
        document.getElementById('login-btn').addEventListener('click', () => signInWithPopup(auth, new GoogleAuthProvider()));
        window.logout = () => signOut(auth);

        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('landing-screen').style.display = 'none';
                document.getElementById('app-interface').style.display = 'flex';
                
                // Update UI
                document.querySelectorAll('.user-avatar').forEach(img => img.src = user.photoURL);
                document.getElementById('profile-name').innerText = user.displayName;

                // CHECK VIP STATUS
                checkVIP(user.uid);
                loadFriends(user.uid);
            } else {
                document.getElementById('landing-screen').style.display = 'flex';
                document.getElementById('app-interface').style.display = 'none';
            }
        });

        // --- VIP LOGIC ---
        function checkVIP(uid) {
            const vipRef = ref(db, `users/${uid}/isVIP`);
            onValue(vipRef, (snapshot) => {
                const isVIP = snapshot.val();
                if (isVIP === true) {
                    // USER IS VIP
                    document.getElementById('vip-status').style.display = 'block'; // Show Badge
                    document.getElementById('ad-box').classList.add('hidden-ad'); // HIDE ADS
                    document.getElementById('buy-vip-btn').innerText = "VIP Active";
                    document.getElementById('buy-vip-btn').disabled = true;
                } else {
                    // USER IS FREE
                    document.getElementById('vip-status').style.display = 'none';
                    document.getElementById('ad-box').classList.remove('hidden-ad'); // SHOW ADS
                }
            });
        }

        window.buyVIP = () => {
            // SIMULATE PAYMENT (In real app, integrate Razorpay here)
            const confirmBuy = confirm("Simulate Payment of ₹199 for VIP?");
            if(confirmBuy) {
                update(ref(db, `users/${currentUser.uid}`), { isVIP: true });
                alert("Payment Successful! Ads Removed.");
            }
        };

        // --- MATCHING ---
        window.startSearch = () => {
            document.getElementById('video-layer').style.display = 'block';
            document.getElementById('searching-ui').style.display = 'flex';
            document.getElementById('next-overlay').style.display = 'none';
            document.getElementById('in-call-controls').style.display = 'none';
            
            findMatch();
        };

        async function findMatch() {
            const queueRef = ref(db, 'queue');
            const snapshot = await get(queueRef);
            let matchFound = false;

            if (snapshot.exists()) {
                snapshot.forEach((child) => {
                    if (!matchFound && child.val().uid !== currentUser.uid && !child.val().matchedWith) {
                        matchFound = true;
                        currentPartnerUID = child.val().uid;
                        const roomID = child.key;
                        set(ref(db, `queue/${child.key}/matchedWith`), currentUser.uid);
                        startZego(roomID);
                    }
                });
            }

            if (!matchFound) {
                const myRef = push(queueRef);
                set(myRef, { uid: currentUser.uid, matchedWith: "" });
                onValue(myRef, (snap) => {
                    if (snap.val()?.matchedWith) {
                        currentPartnerUID = snap.val().matchedWith;
                        startZego(myRef.key);
                        setTimeout(() => remove(myRef), 5000);
                    }
                });
                onDisconnect(myRef).remove();
            }
        }

        function startZego(roomID) {
            document.getElementById('searching-ui').style.display = 'none';
            const appID = 2013687880; 
            const serverSecret = "2576346c100ee42b720e88db26d01e53";
            const kitToken = ZegoUIKitPrebuilt.generateKitTokenForTest(appID, serverSecret, roomID, currentUser.uid, currentUser.displayName);
            
            zegoInstance = ZegoUIKitPrebuilt.create(kitToken);
            zegoInstance.joinRoom({
                container: document.getElementById('video-embed'),
                scenario: { mode: ZegoUIKitPrebuilt.OneONoneCall },
                showPreJoinView: false,
                turnOnCameraWhenJoining: true,
                showLeavingView: false,
                onJoinRoom: () => { document.getElementById('in-call-controls').style.display = 'flex'; },
                onLeaveRoom: () => {
                    if(zegoInstance) zegoInstance.destroy();
                    document.getElementById('in-call-controls').style.display = 'none';
                    document.getElementById('video-embed').innerHTML = "";
                    document.getElementById('next-overlay').style.display = 'flex';
                }
            });
        }

        // --- UTILS ---
        window.retryMatch = () => {
            document.getElementById('next-overlay').style.display = 'none';
            document.getElementById('searching-ui').style.display = 'flex';
            findMatch();
        };
        window.exitVideo = () => {
            if(zegoInstance) zegoInstance.destroy();
            document.getElementById('video-layer').style.display = 'none';
        };
        window.skipUser = () => {
            if(zegoInstance) zegoInstance.destroy();
            // Wait slightly then retry
            setTimeout(() => {
                document.getElementById('next-overlay').style.display = 'none';
                document.getElementById('searching-ui').style.display = 'flex';
                findMatch();
            }, 500);
        };
        window.addFriend = () => {
            if(currentPartnerUID) {
                update(ref(db), { [`users/${currentUser.uid}/friends/${currentPartnerUID}`]: true });
                alert("Added to Connections! ❤️");
            }
        };

        window.switchTab = (tab) => {
            document.querySelectorAll('.screen').forEach(el => el.classList.remove('active-screen'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById('screen-' + tab).classList.add('active-screen');
            const index = tab === 'home' ? 0 : tab === 'messages' ? 1 : 2;
            document.querySelectorAll('.nav-item')[index].classList.add('active');
        };

        function loadFriends(uid) {
            onValue(ref(db, `users/${uid}/friends`), (snapshot) => {
                const list = document.getElementById('friends-list');
                list.innerHTML = "";
                if(snapshot.exists()) {
                    snapshot.forEach((child) => {
                        list.innerHTML += `
                        <div class="friend-row">
                            <img src="https://cdn-icons-png.flaticon.com/512/1077/1077114.png" style="width:40px; border-radius:50%;">
                            <div style="margin-left:15px;">
                                <h4 style="margin:0;">Connection</h4>
                                <small style="color:#aaa;">Start Chat</small>
                            </div>
                        </div>`;
                    });
                } else {
                    list.innerHTML = "<p style='text-align:center; color:#666;'>No connections yet.</p>";
                }
            });
        }
    </script>
</body>
</html>
