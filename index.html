<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ExploreMeet: Riya Edition</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
    
    <!-- External SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://unpkg.com/@zegocloud/zego-uikit-prebuilt/zego-uikit-prebuilt.js"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

    <style>
        :root {
            --primary: #ff007f; /* Neon Pink */
            --secondary: #7f00ff; /* Cyber Purple */
            --dark: #0f0c29;
            --glass: rgba(255, 255, 255, 0.1);
            --text: #ffffff;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: var(--text);
            height: 100vh;
            overflow: hidden;
        }

        /* --- UI UTILITIES --- */
        .hidden { display: none !important; }
        
        .btn {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border: none;
            padding: 12px 24px;
            color: white;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 0 15px var(--primary);
            transition: transform 0.2s;
        }
        .btn:active { transform: scale(0.95); }

        /* --- SCREENS --- */
        #login-screen, #home-screen, #video-container {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        /* Login Screen */
        #login-screen {
            background: url('https://media.giphy.com/media/uIiI5g2Q6W2W9KEXQv/giphy.gif') center/cover no-repeat;
            z-index: 20;
        }
        .glass-panel {
            background: var(--glass);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.2);
            text-align: center;
            max-width: 90%;
            width: 400px;
        }
        h1 { font-family: 'Orbitron', sans-serif; margin-bottom: 20px; text-shadow: 0 0 10px var(--primary); }

        /* Home Screen */
        #home-screen {
            justify-content: flex-start;
            padding-top: 60px;
            overflow-y: auto;
        }
        .profile-card {
            background: rgba(0,0,0,0.6);
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            margin-bottom: 20px;
            border: 1px solid var(--primary);
        }
        .profile-card img {
            width: 80px; height: 80px;
            border-radius: 50%;
            border: 2px solid var(--primary);
            margin-bottom: 10px;
        }
        input, textarea {
            width: 100%;
            padding: 10px;
            margin: 5px 0 15px;
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--secondary);
            color: white;
            border-radius: 5px;
        }

        /* Video Container */
        #video-container {
            background: #000;
            z-index: 100; /* High Z-index but below Riya */
        }
        #zego-canvas {
            width: 100%; height: 100%;
        }

        /* --- RIYA (THE CHARACTER) --- */
        #riya-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 140px;
            height: 180px;
            z-index: 9999; /* Highest Priority */
            cursor: pointer;
            filter: drop-shadow(0 0 10px rgba(255,0,127,0.5));
            transition: transform 0.2s;
        }
        #riya-container:active { transform: scale(0.9); }
        
        #riya-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        /* Speech Bubble */
        .bubble {
            position: absolute;
            bottom: 160px;
            right: 10px;
            background: white;
            color: black;
            padding: 10px 15px;
            border-radius: 15px 15px 0 15px;
            font-size: 12px;
            font-weight: bold;
            width: 200px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 10000;
        }
        .bubble.show { opacity: 1; }

    </style>
</head>
<body>

    <!-- RIYA OVERLAY -->
    <div id="bubble" class="bubble"></div>
    <div id="riya-container" onclick="riya.handleTap()">
        <!-- Default Neutral State -->
        <img id="riya-img" src="https://media.tenor.com/On7kvX_rWQwAAAAi/girl-phone.gif" alt="Riya">
    </div>

    <!-- LOGIN SCREEN -->
    <div id="login-screen">
        <div class="glass-panel">
            <h1>ExploreMeet</h1>
            <p>Connect with Vibes.</p>
            <br>
            <button class="btn" onclick="loginWithGoogle()">Login with Google</button>
        </div>
    </div>

    <!-- HOME SCREEN -->
    <div id="home-screen" class="hidden">
        <div class="profile-card">
            <center>
                <img id="user-photo" src="" alt="Profile">
                <h2 id="user-name">User</h2>
            </center>
            <label>Date of Birth</label>
            <input type="date" id="user-dob">
            <label>Bio (Impress Riya)</label>
            <textarea id="user-bio" rows="2" placeholder="Kuch cool likh..."></textarea>
            <button class="btn" style="width:100%" onclick="saveProfile()">Update Profile</button>
        </div>

        <div class="profile-card" style="text-align: center;">
            <h3>Start Matching</h3>
            <p>Find new friends now!</p>
            <br>
            <button class="btn" onclick="startVideoCall()">Start Video Call</button>
        </div>

        <div class="profile-card" style="text-align: center; border-color: gold;">
            <h3 style="color: gold;">VIP Access</h3>
            <p>Make Riya Happy & Remove Ads</p>
            <br>
            <button class="btn" style="background: gold; color: black;" onclick="buyVIP()">Buy VIP (â‚¹499)</button>
        </div>
    </div>

    <!-- VIDEO CALL CONTAINER -->
    <div id="video-container" class="hidden">
        <div id="zego-canvas"></div>
    </div>

    <script>
        // ==========================================
        // 1. CONFIGURATION
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyDB6H5YFrr7gD7YmRsinknALrp5_RL3dLA",
            authDomain: "exploremeet---live.firebaseapp.com",
            databaseURL: "https://exploremeet---live-default-rtdb.firebaseio.com",
            projectId: "exploremeet---live",
            storageBucket: "exploremeet---live.firebasestorage.app",
            messagingSenderId: "169038218786",
            appId: "1:169038218786:web:4282137dbeb92000dbac7b"
        };

        const zegoConfig = {
            appID: 2013687880,
            serverSecret: "2576346c100ee42b720e88db26d01e53"
        };

        const razorpayKey = "rzp_live_SBirtJRkaeGMgl";

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();
        let currentUser = null;

        // ==========================================
        // 2. RIYA: THE AI CHARACTER LOGIC
        // ==========================================
        const riya = {
            mood: 50, // 0-100
            tapCount: 0,
            isAngry: false,
            voice: null,
            
            // GIF ASSETS (Reliable URLs)
            gifs: {
                neutral: "https://media.tenor.com/On7kvX_rWQwAAAAi/girl-phone.gif", // Girl looking at phone
                angry: "https://media.tenor.com/1sC7lK0xQ6EAAAAi/angry-mad.gif",   // Indian girl angry/scolding
                happy: "https://media.tenor.com/k2wBdb9D9wwAAAAi/priyanka-chopra-laughing.gif" // Laughing
            },

            init: function() {
                // Initialize Voice on user interaction
                window.speechSynthesis.onvoiceschanged = () => {
                    const voices = window.speechSynthesis.getVoices();
                    // Try to find an Indian English or Hindi voice
                    this.voice = voices.find(v => v.lang.includes('IN')) || voices[0];
                };
            },

            setEmotion: function(type) {
                const img = document.getElementById('riya-img');
                if (type === 'neutral') img.src = this.gifs.neutral;
                if (type === 'angry') img.src = this.gifs.angry;
                if (type === 'happy') img.src = this.gifs.happy;
            },

            speak: function(text) {
                // Visual Bubble
                const bubble = document.getElementById('bubble');
                bubble.innerText = text;
                bubble.classList.add('show');
                setTimeout(() => bubble.classList.remove('show'), 4000);

                // Audio
                const utterance = new SpeechSynthesisUtterance(text);
                if (this.voice) utterance.voice = this.voice;
                utterance.pitch = 1.1; // Slightly higher pitch for female voice
                utterance.rate = 1.0;
                window.speechSynthesis.speak(utterance);
            },

            handleTap: function() {
                this.tapCount++;
                
                // VIP Logic Override
                if (this.mood === 100) {
                    this.speak("Arey bas kar hero, main pat gayi hoon!");
                    return;
                }

                if (this.tapCount <= 3) {
                    this.setEmotion('neutral');
                    this.speak("Kya hai? Why are you disturbing me?");
                } else if (this.tapCount <= 6) {
                    this.mood -= 5;
                    this.setEmotion('angry');
                    this.speak("Touch mat kar! Mummy ko bol dungi main!");
                } else {
                    this.isAngry = true;
                    this.mood -= 10;
                    this.setEmotion('angry');
                    this.speak("Bhaav kha rahi hoon main, side hat tu!");
                    // Reset tap count slowly
                    setTimeout(() => { this.tapCount = 0; this.setEmotion('neutral'); }, 5000);
                }
            },

            reactToLogin: function() {
                this.setEmotion('neutral');
                this.speak("Aur janab? Bade dino baad yaad aayi meri?");
            },

            reactToCallStart: function() {
                this.setEmotion('neutral');
                this.speak("Dekh le, koi dhang ki mile toh batana mujhe bhi.");
            },

            reactToCallEnd: function() {
                this.setEmotion('neutral');
                this.speak("Kaisi thi wo? Maza aaya ya paise barbaad?");
            },

            reactToVIP: function() {
                this.mood = 100;
                this.setEmotion('happy');
                this.speak("Oye hoye! Ameer ho gaye tum toh! Chal momos khilati hoon.");
            }
        };

        riya.init();

        // ==========================================
        // 3. AUTHENTICATION & UI FLOW
        // ==========================================
        const ui = {
            login: document.getElementById('login-screen'),
            home: document.getElementById('home-screen'),
            video: document.getElementById('video-container'),
            
            showHome: function() {
                this.login.classList.add('hidden');
                this.video.classList.add('hidden');
                this.home.classList.remove('hidden');
            },
            showVideo: function() {
                this.home.classList.add('hidden');
                this.video.classList.remove('hidden');
            }
        };

        function loginWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider).catch(error => alert(error.message));
        }

        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                document.getElementById('user-photo').src = user.photoURL;
                document.getElementById('user-name').innerText = user.displayName;
                ui.showHome();
                
                // Trigger Riya only once per session ideally, but here on auth state change
                // We use a small timeout to ensure DOM is ready
                setTimeout(() => riya.reactToLogin(), 1000);
            } else {
                ui.login.classList.remove('hidden');
                ui.home.classList.add('hidden');
            }
        });

        function saveProfile() {
            const dob = document.getElementById('user-dob').value;
            const bio = document.getElementById('user-bio').value;
            
            db.ref('users/' + currentUser.uid).set({
                name: currentUser.displayName,
                email: currentUser.email,
                dob: dob,
                bio: bio,
                lastSeen: Date.now()
            });

            riya.setEmotion('happy');
            riya.speak("Profile update kar li? Hero lag raha hai ab.");
        }

        // ==========================================
        // 4. VIDEO CALL (ZEGOCLOUD)
        // ==========================================
        function startVideoCall() {
            riya.reactToCallStart();
            ui.showVideo();

            const roomID = "ExploreMeet_" + Math.floor(Math.random() * 10000);
            const kitToken = ZegoUIKitPrebuilt.generateKitTokenForTest(
                zegoConfig.appID, 
                zegoConfig.serverSecret, 
                roomID, 
                currentUser.uid, 
                currentUser.displayName
            );

            const zp = ZegoUIKitPrebuilt.create(kitToken);
            
            zp.joinRoom({
                container: document.getElementById("zego-canvas"),
                scenario: {
                    mode: ZegoUIKitPrebuilt.OneONOneCall, 
                },
                showPreJoinView: false,
                turnOnCameraWhenJoining: true,
                turnOnMicrophoneWhenJoining: true,
                showMyCameraToggleButton: true,
                showMyMicrophoneToggleButton: true,
                showAudioVideoSettingsButton: true,
                showScreenSharingButton: false,
                // Custom Leave Logic to prevent reload
                onLeaveRoom: () => {
                    ui.showHome();
                    // Destroy instance logic handled by UI switch mostly
                    document.getElementById("zego-canvas").innerHTML = ""; // clear canvas
                    setTimeout(() => riya.reactToCallEnd(), 500);
                }
            });
        }

        // ==========================================
        // 5. PAYMENT (RAZORPAY)
        // ==========================================
        function buyVIP() {
            const options = {
                "key": razorpayKey,
                "amount": "49900", // in paise
                "currency": "INR",
                "name": "ExploreMeet VIP",
                "description": "Make Riya Happy",
                "image": "https://cdn-icons-png.flaticon.com/512/2534/2534204.png",
                "handler": function (response){
                    // Payment Success
                    // Verify payment on server in production
                    db.ref('users/' + currentUser.uid + '/vip').set(true);
                    riya.reactToVIP();
                },
                "prefill": {
                    "name": currentUser.displayName,
                    "email": currentUser.email
                },
                "theme": {
                    "color": "#ff007f"
                }
            };
            const rzp1 = new Razorpay(options);
            rzp1.open();
            rzp1.on('payment.failed', function (response){
                riya.setEmotion('angry');
                riya.speak("Card decline ho gaya? Gareeb!");
            });
        }

    </script>
</body>
</html>